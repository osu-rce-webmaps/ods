<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="authors" content="Benji Antolin">
  <title>ODS Explorer</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Oswald&display=swap" rel="stylesheet">
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
  <link href="css/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/simplebar.css" />
  <link rel="stylesheet" href="css/leaflet.zoomhome.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <script src="js/d3.js"></script>
  <script src="js/c3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="js/chroma.min.js"></script>
  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="js/simplebar.min.js"></script>
  <script src="js/leaflet.zoomhome.min.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
  <script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
</head>

<body>
  <main>
    <div class="loader"></div>
    <div id="textboxes">
      <div id="deck-1" class="card-deck counts">
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title"># of Students Participating
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  # of Students - Participating: The number of students
                  participating in outdoor school is count of the students
                  who participated in outdoor school (either at the time of
                  application (an estimate) or at the time of reporting
                  (the actual number who attended) in a given year or across
                  years in a given geography.
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="stu-count"></span>
          </p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Funding per Student
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  Funding per Student - Our unit of cost for outdoor school is
                  “dollars per student”, so when looking at an amount funded
                  for outdoor school - either an overall average, a threshold
                  amount, or a per specific program average - we express those
                  amounts in dollars per student as well.
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="fps-count"></span>
          </p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">$ Awarded
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  $ Awarded - this is the annual total of dollars awarded/reimbursed
                  to qualifying agencies (school districts, ESDs, and/or state-sponsored
                  charters) within the given geography.
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="awarded-count"></span>
          </p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Avg. Length of Program
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  Avg. Length of Program - The average length of program is a calculation
                  of the average length (in days) of the outdoor school programs attended
                  by 5th and/or 6th grade students in a given year (or across years)
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="avgDays-count"></span>
          </p>
        </div>
      </div>
    </div>
    <div id="info" data-simplebar data-simplebar-auto-hide="true">
      <div id="infobuttons">
        <span><a href="https://facebook.com/sharer.php?u=https://benjiantolin.github.io/law/" target="_blank"><i class="fab fa-facebook-square"></i></a></span>
        <span><a href="https://github.com/benjiantolin/law" target="_blank"><i class="fab fa-github-square"></i></a></span>
        <span><a data-toggle="modal" data-target="#infowindow"><i class="nav fas fa-info-circle"></i></a></span>
      </div>
      <div id="title" style="font-size:30px">Outdoor School Explorer - House Districts</div>


      <p><span id="placename">Oregon State</span></p>
      <span id="hint"> Click on map to review county statistics.</span>

      <!-- <div id="deck-1" class="card-deck counts">
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title"># of Students Participating
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  # of Students - Participating: The number of students
                  participating in outdoor school is count of the students
                  who participated in outdoor school (either at the time of
                  application (an estimate) or at the time of reporting
                  (the actual number who attended) in a given year or across
                  years in a given geography.
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="stu-count"></span>
          </p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Funding per Student
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  Funding per Student - Our unit of cost for outdoor school is
                  “dollars per student”, so when looking at an amount funded
                  for outdoor school - either an overall average, a threshold
                  amount, or a per specific program average - we express those
                  amounts in dollars per student as well.
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="fps-count"></span>
          </p>
        </div>
      </div>
      <div id="deck-1" class="card-deck counts">
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">$ Awarded
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  $ Awarded - this is the annual total of dollars awarded/reimbursed
                  to qualifying agencies (school districts, ESDs, and/or state-sponsored
                  charters) within the given geography.
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="awarded-count"></span>
          </p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">Avg. Length of Program
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  Avg. Length of Program - The average length of program is a calculation
                  of the average length (in days) of the outdoor school programs attended
                  by 5th and/or 6th grade students in a given year (or across years)
                  <span>
              </i>
            </h5>
          </div>
          <p class="card-text"><span class="avgDays-count"></span>
          </p>
        </div>
      </div> -->
      <div id="deck-3" class="card-deck counts">
        <div class="card">
          <center>
            <p>
              # of Students per Year
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  # of Students - receiving Outdoor School funding per year -
                  per the geography selected (county, school district, ESD, or
                  legislative district)
                  <span>
              </i>
            </p>
          </center>
          <div id="stuChart"></div>
        </div>
      </div>
      <hr>
      <div id="deck-3" class="card-deck counts">
        <div class="card">
          <center>
            <p>
              $ Awarded per year
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  $ Awarded per year - the actual cost reimbursed for the outdoor
                  school experiences of the students in that geography. Because of
                  the pandemic, this amount includes (will include) non-refundable
                  deposits and other district incurred costs for outdoor school
                  programs and facilities that had to be cancelled because of state
                  mandated COVID-19 restrictions in 2019-2020 and 2020-2021.
                  <span>
              </i>
            </p>
          </center>
          <div id="awardChart"></div>
        </div>
      </div>
      <hr>
      <div id="deck-3" class="card-deck counts">
        <div class="card">
          <center>
            <p>
              Program lengths (days & nights)
              <i class="fas fa-question-circle tooltip">
                <span class="tooltiptext">
                  Program lengths (days & nights) - Comparison of program lengths used -
                  For data visualization purposes, we track (count) the frequency of
                  attendance for each of the most typical outdoor school programs
                  (such as 3-day 0-night, 3-day 2-night, 4-day 3-night, 5-day 4-night, etc.)
                  in a given year.
                  <span>
              </i>
            </p>
          </center>
          <div id="chart"></div>
        </div>
      </div>

      <!-- <div id="deck-1" class="card-deck counts">
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">% Speaks English well</h5>
          </div>
          <p class="card-text"><span class="death-count"></span><span class="death-new-count"></span></p>
        </div>
        <div class="card">
          <div class="card-body confirmed">
            <h5 class="card-title">% Speaks English less than well</h5>
          </div>
          <p class="card-text"><span class="neg-count"></span><span class="neg-new-count"></span></p>
        </div>
      </div> -->


    </div>


    </div>

    <div id="map"></div>



    <div id="legend-panel">

      <div class="card-deck legend">
        <div id="legend-title">
          <div class="card">
            <div class="card-body legend-color-1">
              <h5 class="card-title" style="color:black">% of Students Participating</h5>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-body legend-color-1">
            <h5 class="card-title" style="color:black">
              < 50%</h5> </div> </div> <div class="card">
                <div class="card-body  legend-color-2">
                  <h5 class="card-title" style="color:black">50-74%</h5>
                </div>
          </div>
          <div class="card">
            <div class="card-body  legend-color-3">
              <h5 class="card-title" style="color:black">75-100%</h5>
            </div>
          </div>
        </div>
      </div>
  </main>
  <div id="infowindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Data Source & Attributions</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p>This web application is intended only as a guide and is based on US Census data.</p>
            <p>Chart Data Source: U.S. Census Bureau, 2013-2017 American Community Survey 5-Year Estimates, <a href="https://data.census.gov/cedsci/table?q=c16001&g=0400000US41,41.050000&tid=ACSDT5Y2017.C16001&hidePreview=false"
                target="_blank">Table: C16001</a></p>
            <p>Choropleth Data Source: U.S. Census Bureau, 2013-2017 American Community Survey 5-Year Estimates, <a href="https://data.census.gov/cedsci/table?q=b16003&g=0400000US41,41.050000&tid=ACSDT5Y2017.B16003&hidePreview=false"
                target="_blank">Table: B16003</a></p>
            <div>
              * If you have any questions or concerns, please contact <a href="mailto:benjiantolin@gmail.com">Benji Antolin</a>.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- <div id="resourcewindow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Coronavirus information resources</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel " data-ride="carousel">
            <p><a href="https://govstatus.egov.com/OR-OHA-COVID-19" target="_blank">Oregon Health Authority</a></p>
            <p><a href="https://www.cdc.gov/coronavirus/2019-ncov/index.html" target="_blank">Center for Disease Control and Prevention (CDC)</a></p>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <!-- <div class="modal-dialog modal-dialog-centered" role="document" style="width:1250px!important">
      <div class="modal-content">
        <div class="modal-header">
          <strong class="modal-title" id="exampleModalLongTitle">Disclaimer</strong>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="demo" class="carousel slide" data-ride="carousel">
            <p>This web application is intended only as a guide and is based on US Census data.</p>
            <p>Chart Data Source: U.S. Census Bureau, 2013-2017 American Community Survey 5-Year Estimates, <a href="https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_17_5YR_C16001&prodType=table" target="_blank">Table: C16001</a></p>
            <p>Choropleth Data Source: U.S. Census Bureau, 2013-2017 American Community Survey 5-Year Estimates, <a href="https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_17_5YR_B16003&prodType=table" target="_blank">Table: B16003</a></p>
          </div>
        </div>
        <div class="modal-footer">
          <div class="col-md-10">
            <span id="mapType">Don't show this info again.</span>
            <label id="nextTimeSwitcher" class="switch">
              <input type="checkbox">
            </label>
          </div>
          <button id="disclaimer-close" type="button" class="btn btn-primary col-md-2">close</button>
        </div>
      </div>
    </div> -->
  </div>
  <script>
    $(window).ready(function() {
      $('.loader').fadeOut("slow");

      $("#nextTimeSwitcher input").on("click", function() {
        if ($("#nextTimeSwitcher input:checked").val() === "on") {
          localStorage.setItem('popState', 'shown');
        } else {

          localStorage.setItem('popState', 'notShown');
        }
      })

      if (localStorage.getItem('popState') != 'shown') {
        console.log("show disclaimer");
        $('#disclaimer').modal('show');

      } else {
        console.log("hide disclaimer");
        $('#disclaimer').modal('hide');
      }
      $('#disclaimer-close').click(function(e) // You are clicking the close button
        {
          $('#disclaimer').fadeOut(); // Now the pop up is hiden.
          $('#disclaimer').modal('hide');
        });
    });

    $(".showFrontPage").on("click", function() {
      $('#disclaimer').modal('show');
      localStorage.setItem('popState', 'notShown');
    })

    $("#date").text("Last update: 4/1/2020");


    var mymap = L.map('map', {
      center: [44, -122.5],
      zoomControl: false,
      zoom: 7,
      maxZoom: 10,
      minZoom: 3,
    });

    new L.Control.zoomHome({
      position: 'topright'
    }).addTo(mymap);


    var gray = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}@2x.png');
    var voyager =
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}@2x.png').addTo(mymap);
    var satellite =
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');

    // mapbox_token = 'pk.eyJ1IjoiYmVuamlhbnRvbGluIiwiYSI6ImNqcm9uazFpczE1ajM0M3Buem83ZGpuY3oifQ.OpSUwJRtxBMPDFUUJnhLVg';
    //       var gl = L.mapboxGL({
    //           accessToken: mapbox_token,
    //           style: 'mapbox://styles/benjiantolin/ck85fv6ct04i71iocpwjx45k8',
    //           // attribution: 'Created By <a href="https://github.com/benjiantolin/">Benjamin Antolin</a> based on the <a href="Assets/license.txt">Mapbox basic style</a>'
    //       }).addTo(map);


    var baseLayers = {
      'CartoDB Light': gray,
      'CartoDB Voyager': voyager,
      'ESRI Satellite': satellite
    }



    var chart;

    // 6. Set function for color ramp
    var colors = chroma.scale('PuBuGn').colors(4);

    for (i = 0; i < 4; i++) {
      $('head').append($("<style> .region-color-" + (i + 1).toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
      $('head').append($("<style> .legend-color-" + (i + 1).toString() + " { background: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    }



    Promise.all([
      d3.csv('assets/houseTimeseries.csv'), //datasets[0]
      d3.json("assets/houseNewMin.geojson"), //datasets[1]
      d3.csv('assets/programLength.csv'), //datasets[2]
    ]).then(function(datasets) {

      $.fn.digits = function() {
        return this.each(function() {
          $(this).text($(this).text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
        })
      }

      var t = ["Year"]
      var l = ["Program Length"]
      var house = ["House District"];
      var schoolsPar = ["Number of Schools"];
      var stuPar = ["Number of Students Participating in ODS"]
      var avgDays = ["Average Length of Program"]
      var totReq = ["$ Awarded"]
      var reqStu = ["$ Awarded per Student"]
      var ods5th = ["Number of 5th Graders Participating"]
      var ode5th = ["Number of 5th Graders During Fall Enrollment"]
      var ods6th = ["Number of 6th Graders Participating"]
      var ode6th = ["Number of 6th Graders During Fall Enrollment"]
      var oneNil = ["1 Day 0 Nights"]
      var oneOne = ["1 Day 1 Night"]
      var twoNil = ["2 Days 0 Nights"]
      var twoOne = ["2 Days 1 Night"]
      var threeNil = ["3 Days 0 Nights"]
      var threeOne = ["3 Days 1 Night"]
      var threeTwo = ["3 Days 2 Nights"]
      var threeThree = ["3 Days 3 Nights"]
      var fourNil = ["4 Days 0 Nights"]
      var fourTwo = ["4 Days 2 Nights"]
      var fourThree = ["4 Days 3 Nights"]
      var fourFive = ["4 Days 5 Nights"]
      var fiveNil = ["5 Days 0 Nights"]
      var fiveFour = ["5 Days 4 Nights"]
      var sixNil = ["6 Days 0 Nights"]
      var sixFive = ["6 Days 5 Nights"]
      var pL2018 = ["2017-18"]
      var pL2019 = ["2018-19"]

      var oregon = {
        name: "Oregon",
        s: schoolsPar,
        stu: stuPar,
        ad: avgDays,
        treq: totReq,
        reqs: reqStu,
        ods5: ods5th,
        ode5: ode5th,
        ods6: ods6th,
        ode6: ode6th,
        one0: oneNil,
        one1: oneOne,
        two0: twoNil,
        two1: twoOne,
        three0: threeNil,
        three1: threeOne,
        three2: threeTwo,
        three3: threeThree,
        four0: fourNil,
        four2: fourTwo,
        four3: fourThree,
        four5: fourFive,
        five0: fiveNil,
        five4: fiveFour,
        six0: sixNil,
        six5: sixFive,
        pL18: pL2018,
        pL19: pL2019,
      }


      function stateCounts(i) {
        ts = 0, tstu = 0, tad = 0, ttreq = 0, treqs = 0,
          tods5 = 0, tode5 = 0, tods6 = 0, tode6 = 0, tone0 = 0,
          tone1 = 0, ttwo0 = 0, ttwo1 = 0, tthree0 = 0, tthree1 = 0,
          tthree2 = 0, tthree3 = 0, tfour0 = 0, tfour2 = 0, tfour3 = 0,
          tfour5 = 0, tfive0 = 0, tfive4 = 0, tsix0 = 0, tsix5 = 0,
          tpl18 = 0, tpl19 = 0;
        datasets[0].forEach(function(d) {
          t.push(d["Year"]);
          ts = 0, tstu = 0, tad = 0, ttreq = 0, treqs = 0,
            tods5 = 0, tode5 = 0, tods6 = 0, tode6 = 0, tone0 = 0,
            tone1 = 0, ttwo0 = 0, ttwo1 = 0, tthree0 = 0, tthree1 = 0,
            tthree2 = 0, tthree3 = 0, tfour0 = 0, tfour2 = 0, tfour3 = 0,
            tfour5 = 0, tfive0 = 0, tfive4 = 0, tsix0 = 0, tsix5 = 0;
          current = d;
          delete current["Year"];
          if (i["name"] = "Oregon") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 25:
                tsix5 += +items[24];
              case 24:
                tsix0 += +items[23];
              case 23:
                tfive4 += +items[22];
              case 22:
                tfive0 += +items[21];
              case 21:
                tfour5 += +items[20];
              case 20:
                tfour3 += +items[19];
              case 19:
                tfour2 += +items[18];
              case 18:
                tfour0 += +items[17];
              case 17:
                tthree3 += +items[16];
              case 16:
                tthree2 += +items[15];
              case 15:
                tthree1 += +items[14];
              case 14:
                tthree0 += +items[13];
              case 13:
                ttwo1 += +items[12];
              case 12:
                ttwo0 += +items[11];
              case 11:
                tone1 += +items[10];
              case 10:
                tone0 += +items[9];
              case 9:
                tode6 += +items[8];
              case 8:
                tods6 += +items[7];
              case 7:
                tode5 += +items[6];
              case 6:
                tods5 += +items[5];
              case 5:
                treqs += +items[4];
              case 4:
                ttreq += +items[3];
              case 3:
                tad += +items[2];
              case 2:
                tstu += +items[1];
              case 1:
                ts += +items[0];
                break;
            };

          }
          i["s"].push(ts);
          i["stu"].push(tstu);
          i["ad"].push(tad);
          i["treq"].push(ttreq);
          i["reqs"].push(treqs);
          i["ods5"].push(tods5);
          i["ode5"].push(tode5);
          i["ods6"].push(tods6);
          i["ode6"].push(tode6);
          i["one0"].push(tone0);
          i["one1"].push(tone1);
          i["two0"].push(ttwo0);
          i["two1"].push(ttwo1);
          i["three0"].push(tthree0);
          i["three1"].push(tthree1);
          i["three2"].push(tthree2);
          i["three3"].push(tthree3);
          i["four0"].push(tfour0);
          i["four2"].push(tfour2);
          i["four3"].push(tfour3);
          i["four5"].push(tfour5);
          i["five0"].push(tfive0);
          i["five4"].push(tfive4);
          i["six0"].push(tsix0);
          i["six5"].push(tsix5);

        });

        datasets[2].forEach(function(d) {
          l.push(d["Length"]);
          tpl18 = 0, tpl19 = 0;
          current = d;
          delete current["Length"];
          if (i["name"] = "Oregon") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 2:
                tpl19 += +items[1];
              case 1:
                tpl18 += +items[0];
                break;
            };

          }
          i["pL18"].push(tpl18);
          i["pL19"].push(tpl19);

        });

        // var wellPerc = i.wc[1];
        // var lessPerc = i.lc[1];

        $(".stu-count").text('37,779');
        $(".fps-count").text('$301.37');
        $(".awarded-count").text('$11,385,394');
        $(".avgDays-count").text('3.77 Days');
        $("#deck-1 > div:nth-child(1) > p > span.cases-count").digits();
        // $("#deck-1 > div:nth-child(1) > p > span.death-count").digits();
        // $("#deck-1 > div:nth-child(2) > p > span.neg-count").digits();


        // $(".confirmed-new-count").text("+"+cc);
        // $(".active-new-count").text(cd);


        // nc = i.c[i.c.length - 1] - i.c[i.c.length - 2];
        // nd = i.d[i.d.length - 1] - i.d[i.d.length - 2];
        // nnt = i.neg[i.neg.length - 1] - i.neg[i.neg.length - 2];

        // if (nc > 0) {
        //   $(".confirmed-new-count").text("+" + nc.toString());
        // } else if (nc == 0) {
        //   $(".confirmed-new-count").text("");
        // } else {
        //
        //   $(".confirmed-new-count").text(nc.toString());
        // }
        //
        // if (nd > 0) {
        //   $(".death-new-count").text("+" + nd.toString());
        // } else if (nd == 0) {
        //   $(".death-new-count").text("")
        // } else {
        //   $(".death-new-count").text(nd.toString());
        // }

        // if (nnt > 0) {
        //   $(".neg-new-count").text("+" + nnt.toString());
        // } else if (nnt == 0) {
        //   $(".neg-new-count").text("")
        // } else {
        //   $(".neg-new-count").text(nnt.toString());
        // }
        //
        //


        if (i["name"] == "Oregon") {
          $("#placename").text(i["name"] + " State");

        } else {

          $("#placename").text(i["name"]);

        }




      }

      function countyCounts(i) {
        ts = 0, tstu = 0, tad = 0, ttreq = 0, treqs = 0,
          tods5 = 0, tode5 = 0, tods6 = 0, tode6 = 0, tone0 = 0,
          tone1 = 0, ttwo0 = 0, ttwo1 = 0, tthree0 = 0, tthree1 = 0,
          tthree2 = 0, tthree3 = 0, tfour0 = 0, tfour2 = 0, tfour3 = 0,
          tfour5 = 0, tfive0 = 0, tfive4 = 0, tsix0 = 0, tsix5 = 0,
          tpl18 = 0, tpl19 = 0;
        datasets[0].forEach(function(d) {
          t.push(d["Year"]);
          ts = 0, tstu = 0, tad = 0, ttreq = 0, treqs = 0,
            tods5 = 0, tode5 = 0, tods6 = 0, tode6 = 0, tone0 = 0,
            tone1 = 0, ttwo0 = 0, ttwo1 = 0, tthree0 = 0, tthree1 = 0,
            tthree2 = 0, tthree3 = 0, tfour0 = 0, tfour2 = 0, tfour3 = 0,
            tfour5 = 0, tfive0 = 0, tfive4 = 0, tsix0 = 0, tsix5 = 0;
          current = d;
          delete current["Year"];
          if (i["name"] != "Oregon") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 25:
                tsix5 += +items[24];
              case 24:
                tsix0 += +items[23];
              case 23:
                tfive4 += +items[22];
              case 22:
                tfive0 += +items[21];
              case 21:
                tfour5 += +items[20];
              case 20:
                tfour3 += +items[19];
              case 19:
                tfour2 += +items[18];
              case 18:
                tfour0 += +items[17];
              case 17:
                tthree3 += +items[16];
              case 16:
                tthree2 += +items[15];
              case 15:
                tthree1 += +items[14];
              case 14:
                tthree0 += +items[13];
              case 13:
                ttwo1 += +items[12];
              case 12:
                ttwo0 += +items[11];
              case 11:
                tone1 += +items[10];
              case 10:
                tone0 += +items[9];
              case 9:
                tode6 += +items[8];
              case 8:
                tods6 += +items[7];
              case 7:
                tode5 += +items[6];
              case 6:
                tods5 += +items[5];
              case 5:
                treqs += +items[4];
              case 4:
                ttreq += +items[3];
              case 3:
                tad += +items[2];
              case 2:
                tstu += +items[1];
              case 1:
                ts += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 25:
                  tsix5 += +items[24];
                case 24:
                  tsix0 += +items[23];
                case 23:
                  tfive4 += +items[22];
                case 22:
                  tfive0 += +items[21];
                case 21:
                  tfour5 += +items[20];
                case 20:
                  tfour3 += +items[19];
                case 19:
                  tfour2 += +items[18];
                case 18:
                  tfour0 += +items[17];
                case 17:
                  tthree3 += +items[16];
                case 16:
                  tthree2 += +items[15];
                case 15:
                  tthree1 += +items[14];
                case 14:
                  tthree0 += +items[13];
                case 13:
                  ttwo1 += +items[12];
                case 12:
                  ttwo0 += +items[11];
                case 11:
                  tone1 += +items[10];
                case 10:
                  tone0 += +items[9];
                case 9:
                  tode6 += +items[8];
                case 8:
                  tods6 += +items[7];
                case 7:
                  tode5 += +items[6];
                case 6:
                  tods5 += +items[5];
                case 5:
                  treqs += +items[4];
                case 4:
                  ttreq += +items[3];
                case 3:
                  tad += +items[2];
                case 2:
                  tstu += +items[1];
                case 1:
                  ts += +items[0];
                  break;
              };

            });
            //
          }
          i["s"].push(ts);
          i["stu"].push(tstu);
          i["ad"].push(tad);
          i["treq"].push(ttreq);
          i["reqs"].push(treqs);
          i["ods5"].push(tods5);
          i["ode5"].push(tode5);
          i["ods6"].push(tods6);
          i["ode6"].push(tode6);
          i["one0"].push(tone0);
          i["one1"].push(tone1);
          i["two0"].push(ttwo0);
          i["two1"].push(ttwo1);
          i["three0"].push(tthree0);
          i["three1"].push(tthree1);
          i["three2"].push(tthree2);
          i["three3"].push(tthree3);
          i["four0"].push(tfour0);
          i["four2"].push(tfour2);
          i["four3"].push(tfour3);
          i["four5"].push(tfour5);
          i["five0"].push(tfive0);
          i["five4"].push(tfive4);
          i["six0"].push(tsix0);
          i["six5"].push(tsix5);
        });


        datasets[2].forEach(function(d) {
          l.push(d["Length"]);
          tpl18 = 0, tpl19 = 0;
          current = d;
          delete current["Length"];
          if (i["name"] != "Oregon") {
            d = current[i["name"]];
            if (d == undefined) {
              d = "0"
            };
            items = d.split("-");
            switch (items.length) {
              case 2:
                tpl19 += +items[1];
              case 1:
                tpl18 += +items[0];
                break;
            };

          } else {

            Object.values(current).forEach(function(d) {
              if (d == undefined) {
                d = "0"
              };
              items = d.split("-");
              switch (items.length) {
                case 2:
                  tpl19 += +items[1];
                case 1:
                  tpl18 += +items[0];
                  break;
              };

            });
            //
          }
          i["pL18"].push(tpl18);
          i["pL19"].push(tpl19);
        });



        if (i["name"] == "Oregon") {
          $("#placename").text(i["name"] + " State");

        } else {

          $("#placename").text(i["name"]);

        }


      }



      function setColor(lepHH) {
        var id = 0;
        if (lepHH > .75) {
          id = 2;
        } else if (lepHH > .5 && lepHH <= .75) {
          id = 1;
        } else {
          id = 0;
        }
        return colors[id];
      }


      function style(feature) {
        return {
          fillColor: setColor(feature.properties.per_per201),
          fillOpacity: 0.4,
          weight: 2,
          opacity: 1,
          color: '#b4b4b4',
          dashArray: '4'
        };
      }



      function highlightFeature(e) {
        // e indicates the current event
        var layer = e.target; //the target capture the object which the event associates with
        layer.setStyle({
          weight: 4,
          opacity: 0.8,
          color: '#e3e3e3',
          fillColor: '#00ffd9',
          fillOpacity: 0.1
        });
        // bring the layer to the front.
        layer.bringToFront();
      }

      // 3.2.2 zoom to the highlighted feature when the mouse is clicking onto it.
      function zoomToFeature(e) {
        // mymap.fitBounds(e.target.getBounds());
        L.DomEvent.stopPropagation(e);
        $("#hint").text("Click here to for State trend.");


        var t = ["Year"]
        var l = ["Program Length"]
        var house = ["House District"];
        var schoolsPar = ["Number of Schools"];
        var stuPar = ["Number of Students Participating in ODS"]
        var avgDays = ["Average Length of Program"]
        var totReq = ["$ Awarded"]
        var reqStu = ["$ Awarded per Student"]
        var ods5th = ["Number of 5th Graders Participating"]
        var ode5th = ["Number of 5th Graders During Fall Enrollment"]
        var ods6th = ["Number of 6th Graders Participating"]
        var ode6th = ["Number of 6th Graders During Fall Enrollment"]
        var oneNil = ["1 Day 0 Nights"]
        var oneOne = ["1 Day 1 Night"]
        var twoNil = ["2 Days 0 Nights"]
        var twoOne = ["2 Days 1 Night"]
        var threeNil = ["3 Days 0 Nights"]
        var threeOne = ["3 Days 1 Night"]
        var threeTwo = ["3 Days 2 Nights"]
        var threeThree = ["3 Days 3 Nights"]
        var fourNil = ["4 Days 0 Nights"]
        var fourTwo = ["4 Days 2 Nights"]
        var fourThree = ["4 Days 3 Nights"]
        var fourFive = ["4 Days 5 Nights"]
        var fiveNil = ["5 Days 0 Nights"]
        var fiveFour = ["5 Days 4 Nights"]
        var sixNil = ["6 Days 0 Nights"]
        var sixFive = ["6 Days 5 Nights"]
        var pL2018 = ["2017-18"]
        var pL2019 = ["2018-19"]

        var place = {
          name: e.target.feature.properties.house_geo,
          s: schoolsPar,
          stu: stuPar,
          ad: avgDays,
          treq: totReq,
          reqs: reqStu,
          ods5: ods5th,
          ode5: ode5th,
          ods6: ods6th,
          ode6: ode6th,
          one0: oneNil,
          one1: oneOne,
          two0: twoNil,
          two1: twoOne,
          three0: threeNil,
          three1: threeOne,
          three2: threeTwo,
          three3: threeThree,
          four0: fourNil,
          four2: fourTwo,
          four3: fourThree,
          four5: fourFive,
          five0: fiveNil,
          five4: fiveFour,
          six0: sixNil,
          six5: sixFive,
          pL18: pL2018,
          pL19: pL2019,
        }

        countyCounts(place);

        $(".stu-count").text(e.target.feature.properties.students_1);
        // $(".fps-count").text((e.target.feature.properties.reqStu2018)).toFixed(2);
        $(".fps-count").text("$ " + (e.target.feature.properties.reqStu2018).toFixed(2));
        $(".awarded-count").text("$ " + (e.target.feature.properties.totReque_1).toFixed(2)).digits();
        $(".avgDays-count").text((e.target.feature.properties.avgDays2_1).toFixed(2) + " Days");
        $("#placename").text(e.target.feature.properties.NAMELSAD);
        // $(".death-count").text(tw);
        // $(".neg-count").text(tnw);
        stuChart.load({
          unload: true,
          columns: [place.stu],
        });

        awardChart.load({
          unload: true,
          columns: [place.treq],
        });

        chart.load({
          unload: true,
          columns: [
            place.pL18, place.pL19
          ],
        });


      }

      // 3.2.3 reset the hightlighted feature when the mouse is out of its region.
      function resetHighlight(e) {
        county.resetStyle(e.target);

      }

      // 3.3 add these event the layer obejct.
      function onEachFeature(feature, layer) {
        layer.on({
          mouseover: highlightFeature,
          click: zoomToFeature,
          mouseout: resetHighlight
        });
      }



      var county = new L.GeoJSON(datasets[1], {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(mymap);
      // mymap.fitBounds(county.getBounds());

      new L.control.layers(baseLayers, {
        // "Infection Level": areas,
        // "Infection Case(s) &nbsp;&nbsp; <i class='fas fa-users community'></i>": cases,
        // "Infected Community &nbsp;&nbsp; <i class='fas fa-procedures community'></i>": communities
      }, {
        collapsed: false
      }).addTo(mymap);



      $("#hint").on("click", function() {
        // stateCounts(oregon);
        $(".stu-count").text('37,779');
        $(".fps-count").text('$301.37');
        $(".awarded-count").text('$11,385,394');
        $(".avgDays-count").text('3.77 Days');
        $("#placename").text('Oregon State');

        stuChart.load({
          unload: true,
          columns: [oregon.stu],
        });

        awardChart.load({
          unload: true,
          columns: [oregon.treq],
        });

        chart.load({
          unload: true,
          columns: [
            oregon.pL18, oregon.pL19
          ],
        });
        $("#hint").text("Click on map to review county trend.");

      });


      function onMapClick(e) {
        $("#hint").click();
      }

      mymap.on('click', onMapClick);

      stateCounts(oregon);


      stuChart = c3.generate({
        size: {
    height: 220,
    width: 480
},
        data: {
          columns: [oregon.stu],
          type: 'bar'
        },
        bar: {
          width: {
            ratio: 0.25 // this makes bar width 50% of length between ticks
          }
          // or
          //width: 100 // this makes bar width 100px
        },
        axis: {
          x: {
            type: "category",
            categories: ["2017-18", "2018-19"],
          },
        },
        tooltip: {
          format: {
            value: function(value, ratio, id) {
              var format = id === 'data1' ? d3.format(',') : d3.format(',');
              return format(value);
            }
          },
          show: true,
          grouped: false,
        },
        bindto: "#stuChart"
      });

      awardChart = c3.generate({
        size: {
    height: 220,
    width: 480
},
        data: {
          columns: [oregon.treq],
          type: 'bar',
        },
        color: {
          pattern: ['#dc3545']
        },
        bar: {
          width: {
            ratio: 0.25 // this makes bar width 50% of length between ticks
          }
          // or
          //width: 100 // this makes bar width 100px
        },
        axis: {
          x: {
            type: "category",
            categories: ["2017-18", "2018-19"],
          },
          y : {
    tick: {
        format: d3.format("$,")
//                format: function (d) { return "$" + d; }
    }
}
        },
        tooltip: {
          format: {
            value: function(value, ratio, id) {
              var format = id === 'data1' ? d3.format(',') : d3.format('$');
              return format(value);
            }
          },
          show: true,
          grouped: false,
        },
        bindto: "#awardChart"
      });

      chart = c3.generate({
        size: {
    height: 220,
    width: 480
},
        data: {
          // x: "t",
          columns: [
            oregon.pL18, oregon.pL19
          ],
          type: 'bar',
        },
        legend: {
    position: 'right'
},
        axis: {
          x: {
            type: "category",
            categories: ["3 Days 0 Nights", "4 Days 0 Nights", "3 Days 2 Nights",
                        "4 Days 3 Nights","5 Days 4 Nights", "6 Days 5 Nights",
          ],
          },
        },
        tooltip: {
          format: {
            value: function(value, ratio, id) {
              var format = id === 'data1' ? d3.format(',') : d3.format(',');
              return format(value);
            }
          },
          show: true,
          grouped: false,
        },
        bindto: "#chart"
      });


    });

    /////////////////////////
    $(".leaflet-control-attribution")
      .css("background-color", "transparent")
      .html("");
  </script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140689399-8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-140689399-8');
  </script>

</body>

</html>
